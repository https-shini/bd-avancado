# ğŸ® ExercÃ­cio 2: Jogo JokenpÃ´ em PL/SQL

**PontuaÃ§Ã£o:** 0.5 ponto (25% da nota total)

---

## ğŸ“‹ Enunciado Completo

> Utilizando PL/SQL, crie um script que simule o jogo JokenpÃ´ (Pedra, Papel e Tesoura), com os seguintes requisitos:

### Requisitos TÃ©cnicos

#### a) Jogadas - UsuÃ¡rio e Computador (30%)
- O usuÃ¡rio deverÃ¡ **informar a sua jogada** (Pedra, Papel ou Tesoura)
- O Oracle deverÃ¡ **gerar automaticamente a jogada do PC**, de forma **aleatÃ³ria**

#### b) ComparaÃ§Ã£o e Resultado (30%)
- O script deve **comparar as jogadas** do usuÃ¡rio e do computador
- **Definir** se a jogada resultou em:
  - Empate
  - VitÃ³ria do usuÃ¡rio
  - VitÃ³ria do PC

#### c) PersistÃªncia e EstatÃ­sticas (40%)
- **Salvar cada jogada** realizada em uma tabela (INSERT)
- Criar uma **consulta** que exiba:
  - Total de vitÃ³rias do UsuÃ¡rio
  - Total de vitÃ³rias do PC
  - Total de empates

---

## ğŸ¯ CritÃ©rios de AvaliaÃ§Ã£o

| CritÃ©rio | Peso | DescriÃ§Ã£o |
|----------|------|-----------|
| **GeraÃ§Ã£o AleatÃ³ria** | 25% | Uso correto de `DBMS_RANDOM` |
| **LÃ³gica de ComparaÃ§Ã£o** | 25% | Todas as combinaÃ§Ãµes implementadas |
| **PersistÃªncia** | 25% | INSERT correto apÃ³s cada jogada |
| **Consultas/Views** | 25% | EstatÃ­sticas completas e corretas |

---

## ğŸ—ï¸ Arquitetura da SoluÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ORACLE DATABASE                      â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Tabela: tbJokenpo                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ idJogada | jogadaUsuario | jogadaPC |   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ resultado | dataJogada                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Procedure: jogarJokenpo(p_jogada)         â”‚  â”‚
â”‚  â”‚  1. Gera jogada PC (DBMS_RANDOM)               â”‚  â”‚
â”‚  â”‚  2. Compara jogadas (IF-ELSIF-ELSE)            â”‚  â”‚
â”‚  â”‚  3. Determina resultado                         â”‚  â”‚
â”‚  â”‚  4. INSERT na tabela                            â”‚  â”‚
â”‚  â”‚  5. DBMS_OUTPUT resultado                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        View: vwEstatisticasJokenpo             â”‚  â”‚
â”‚  â”‚  - Total de Jogadas                            â”‚  â”‚
â”‚  â”‚  - VitÃ³rias do UsuÃ¡rio                         â”‚  â”‚
â”‚  â”‚  - VitÃ³rias do PC                              â”‚  â”‚
â”‚  â”‚  - Empates                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        View: vwHistoricoJokenpo                â”‚  â”‚
â”‚  â”‚  - HistÃ³rico completo de partidas              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Estrutura do Banco de Dados Oracle

## ğŸ”§ Stored Procedure: `jogarJokenpo`

### CÃ³digo Completo

```sql
-- ============================
-- 1. CRIAÃ‡ÃƒO DA TABELA DE JOGADAS
-- ============================
CREATE TABLE tb_jokenpo_resultado (
    id_jogada NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    jogada_usuario VARCHAR2(10),
    jogada_pc VARCHAR2(10),
    vencedor VARCHAR2(10),
    data_jogada DATE DEFAULT SYSDATE
);

-- ============================
-- 2. SIMULAÃ‡ÃƒO DE UMA RODADA
-- ============================
DECLARE
    v_jogada_usuario VARCHAR2(10) := 'Pedra';
    v_jogada_pc_num NUMBER;
    v_jogada_pc_txt VARCHAR2(10);
    v_vencedor VARCHAR2(10);
BEGIN
    v_jogada_usuario := INITCAP(LOWER(v_jogada_usuario));

    IF v_jogada_usuario NOT IN ('Pedra', 'Papel', 'Tesoura') THEN
        RAISE_APPLICATION_ERROR(-20001, 'Jogada invÃ¡lida. Use Pedra, Papel ou Tesoura.');
    END IF;

    v_jogada_pc_num := TRUNC(DBMS_RANDOM.VALUE(1, 4));
    CASE v_jogada_pc_num
        WHEN 1 THEN v_jogada_pc_txt := 'Pedra';
        WHEN 2 THEN v_jogada_pc_txt := 'Papel';
        WHEN 3 THEN v_jogada_pc_txt := 'Tesoura';
    END CASE;

    IF v_jogada_usuario = v_jogada_pc_txt THEN
        v_vencedor := 'Empate';
    ELSIF (v_jogada_usuario = 'Pedra' AND v_jogada_pc_txt = 'Tesoura') OR
          (v_jogada_usuario = 'Tesoura' AND v_jogada_pc_txt = 'Papel') OR
          (v_jogada_usuario = 'Papel' AND v_jogada_pc_txt = 'Pedra') THEN
        v_vencedor := 'UsuÃ¡rio';
    ELSE
        v_vencedor := 'PC';
    END IF;

    DBMS_OUTPUT.PUT_LINE('==============================');
    DBMS_OUTPUT.PUT_LINE('RESULTADO DA RODADA');
    DBMS_OUTPUT.PUT_LINE('------------------------------');
    DBMS_OUTPUT.PUT_LINE('Jogador:    ' || RPAD(v_jogada_usuario, 10));
    DBMS_OUTPUT.PUT_LINE('Computador: ' || RPAD(v_jogada_pc_txt, 10));
    DBMS_OUTPUT.PUT_LINE('Vencedor:   ' || RPAD(v_vencedor, 10));
    DBMS_OUTPUT.PUT_LINE('------------------------------');
    DBMS_OUTPUT.PUT_LINE('Jogada registrada com sucesso!');
    DBMS_OUTPUT.PUT_LINE('==============================');

    INSERT INTO tb_jokenpo_resultado (jogada_usuario, jogada_pc, vencedor)
    VALUES (v_jogada_usuario, v_jogada_pc_txt, v_vencedor);

    DBMS_OUTPUT.PUT_LINE('Resultado registrado com sucesso!');
END;
/

-- ============================
-- 3. CRIAÃ‡ÃƒO DAS VIEWS
-- ============================
CREATE OR REPLACE VIEW vwHistoricoJokenpo AS
SELECT 
    id_jogada AS "ID da Jogada",
    jogada_usuario AS "Jogada do UsuÃ¡rio",
    jogada_pc AS "Jogada do PC",
    vencedor AS "Vencedor",
    TO_CHAR(data_jogada, 'DD/MM/YYYY HH24:MI:SS') AS "Data da Jogada"
FROM tb_jokenpo_resultado;

CREATE OR REPLACE VIEW vwEstatisticasJokenpo AS
SELECT 
    COUNT(*) AS "Total de Jogadas",
    COUNT(CASE WHEN vencedor = 'UsuÃ¡rio' THEN 1 END) AS "VitÃ³rias do UsuÃ¡rio",
    COUNT(CASE WHEN vencedor = 'PC' THEN 1 END) AS "VitÃ³rias do PC",
    COUNT(CASE WHEN vencedor = 'Empate' THEN 1 END) AS "Empates"
FROM tb_jokenpo_resultado;

-- ============================
-- 4. CONSULTA Ã€S VIEWS
-- ============================
SELECT * FROM vwHistoricoJokenpo;
SELECT * FROM vwEstatisticasJokenpo;

-- ============================
-- 5. LIMPEZA DO AMBIENTE
-- ============================
DELETE FROM tb_jokenpo_resultado;
COMMIT;

DROP VIEW vwHistoricoJokenpo;
DROP VIEW vwEstatisticasJokenpo;

DROP TABLE tb_jokenpo_resultado;
```

---

## âœ… Checklist de ValidaÃ§Ã£o

- [ ] Tabela `tbJokenpo` criada com sucesso
- [ ] Procedure `jogarJokenpo` compilada sem erros
- [ ] Views `vwEstatisticasJokenpo` e `vwHistoricoJokenpo` criadas
- [ ] Jogadas executadas com `SET SERVEROUTPUT ON`
- [ ] SaÃ­da mostra resultado de cada partida
- [ ] Dados inseridos na tabela confirmados
- [ ] View de estatÃ­sticas mostra totais corretos
- [ ] View de histÃ³rico lista todas as jogadas
- [ ] Prints capturados para entrega
- [ ] CÃ³digo comentado e documentado

---

## ğŸ“ Aprendizados do ExercÃ­cio

Este exercÃ­cio demonstra:

1. **Aleatoriedade em PL/SQL** - Uso do package `DBMS_RANDOM`
2. **LÃ³gica condicional complexa** - MÃºltiplas condiÃ§Ãµes com OR
3. **PersistÃªncia de dados** - INSERT apÃ³s cada operaÃ§Ã£o
4. **Views para relatÃ³rios** - AgregaÃ§Ã£o de dados com CASE WHEN
5. **Procedures parametrizadas** - Receber entrada do usuÃ¡rio
6. **Tratamento de transaÃ§Ãµes** - COMMIT explÃ­cito

---

## ğŸ“Š Exemplo de Resultados

### ApÃ³s 10 Jogadas

**vwEstatisticasJokenpo:**
```
Total de Jogadas | VitÃ³rias do UsuÃ¡rio | VitÃ³rias do PC | Empates
-----------------|---------------------|----------------|--------
      10         |          3          |       5        |    2
```

**vwHistoricoJokenpo (Ãºltimas 5):**
```
ID | Jogada UsuÃ¡rio | Jogada PC | Resultado            | Data/Hora
---|----------------|-----------|----------------------|-------------------
10 | Papel          | Tesoura   | VitÃ³ria do PC        | 20/10/2025 15:45:32
9  | Pedra          | Pedra     | Empate               | 20/10/2025 15:45:31
8  | Tesoura        | Papel     | VitÃ³ria do UsuÃ¡rio   | 20/10/2025 15:45:30
7  | Papel          | Pedra     | VitÃ³ria do UsuÃ¡rio   | 20/10/2025 15:45:29
6  | Pedra          | Papel     | VitÃ³ria do PC        | 20/10/2025 15:45:28
```

---

## ğŸ”— ReferÃªncias

- [Oracle DBMS_RANDOM Documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_RANDOM.html)
- [Oracle PL/SQL IF Statement](https://docs.oracle.com/en/database/oracle/oracle-database/19/lnpls/plsql-control-statements.html)
- [Oracle DBMS_OUTPUT](https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_OUTPUT.html)

---

**ğŸ“… Ãšltima atualizaÃ§Ã£o:** 20/10/2025  
**âœï¸ Autor:** Equipe LBDA  
**ğŸ“§ DÃºvidas:** Consultar professor ou monitor
