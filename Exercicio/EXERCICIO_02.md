# 🎮 Exercício 2: Jogo Jokenpô em PL/SQL

**Pontuação:** 0.5 ponto (25% da nota total)

---

## 📋 Enunciado Completo

> Utilizando PL/SQL, crie um script que simule o jogo Jokenpô (Pedra, Papel e Tesoura), com os seguintes requisitos:

### Requisitos Técnicos

#### a) Jogadas - Usuário e Computador (30%)
- O usuário deverá **informar a sua jogada** (Pedra, Papel ou Tesoura)
- O Oracle deverá **gerar automaticamente a jogada do PC**, de forma **aleatória**

#### b) Comparação e Resultado (30%)
- O script deve **comparar as jogadas** do usuário e do computador
- **Definir** se a jogada resultou em:
  - Empate
  - Vitória do usuário
  - Vitória do PC

#### c) Persistência e Estatísticas (40%)
- **Salvar cada jogada** realizada em uma tabela (INSERT)
- Criar uma **consulta** que exiba:
  - Total de vitórias do Usuário
  - Total de vitórias do PC
  - Total de empates

---

## 🎯 Critérios de Avaliação

| Critério | Peso | Descrição |
|----------|------|-----------|
| **Geração Aleatória** | 25% | Uso correto de `DBMS_RANDOM` |
| **Lógica de Comparação** | 25% | Todas as combinações implementadas |
| **Persistência** | 25% | INSERT correto após cada jogada |
| **Consultas/Views** | 25% | Estatísticas completas e corretas |

---

## 🏗️ Arquitetura da Solução

```
┌────────────────────────────────────────────────────────┐
│                   ORACLE DATABASE                      │
│                                                        │
│  ┌─────────────────────────────────────────────────┐  │
│  │           Tabela: tbJokenpo                     │  │
│  │  ┌──────────────────────────────────────────┐  │  │
│  │  │ idJogada | jogadaUsuario | jogadaPC |   │  │  │
│  │  │ resultado | dataJogada                   │  │  │
│  │  └──────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────┘  │
│                                                        │
│  ┌─────────────────────────────────────────────────┐  │
│  │      Procedure: jogarJokenpo(p_jogada)         │  │
│  │  1. Gera jogada PC (DBMS_RANDOM)               │  │
│  │  2. Compara jogadas (IF-ELSIF-ELSE)            │  │
│  │  3. Determina resultado                         │  │
│  │  4. INSERT na tabela                            │  │
│  │  5. DBMS_OUTPUT resultado                       │  │
│  └─────────────────────────────────────────────────┘  │
│                                                        │
│  ┌─────────────────────────────────────────────────┐  │
│  │        View: vwEstatisticasJokenpo             │  │
│  │  - Total de Jogadas                            │  │
│  │  - Vitórias do Usuário                         │  │
│  │  - Vitórias do PC                              │  │
│  │  - Empates                                     │  │
│  └─────────────────────────────────────────────────┘  │
│                                                        │
│  ┌─────────────────────────────────────────────────┐  │
│  │        View: vwHistoricoJokenpo                │  │
│  │  - Histórico completo de partidas              │  │
│  └─────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────┘
```

---

## 💾 Estrutura do Banco de Dados Oracle

## 🔧 Stored Procedure: `jogarJokenpo`

### Código Completo

```sql
-- ============================
-- 1. CRIAÇÃO DA TABELA DE JOGADAS
-- ============================
CREATE TABLE tb_jokenpo_resultado (
    id_jogada NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    jogada_usuario VARCHAR2(10),
    jogada_pc VARCHAR2(10),
    vencedor VARCHAR2(10),
    data_jogada DATE DEFAULT SYSDATE
);

-- ============================
-- 2. SIMULAÇÃO DE UMA RODADA
-- ============================
DECLARE
    v_jogada_usuario VARCHAR2(10) := 'Pedra';
    v_jogada_pc_num NUMBER;
    v_jogada_pc_txt VARCHAR2(10);
    v_vencedor VARCHAR2(10);
BEGIN
    v_jogada_usuario := INITCAP(LOWER(v_jogada_usuario));

    IF v_jogada_usuario NOT IN ('Pedra', 'Papel', 'Tesoura') THEN
        RAISE_APPLICATION_ERROR(-20001, 'Jogada inválida. Use Pedra, Papel ou Tesoura.');
    END IF;

    v_jogada_pc_num := TRUNC(DBMS_RANDOM.VALUE(1, 4));
    CASE v_jogada_pc_num
        WHEN 1 THEN v_jogada_pc_txt := 'Pedra';
        WHEN 2 THEN v_jogada_pc_txt := 'Papel';
        WHEN 3 THEN v_jogada_pc_txt := 'Tesoura';
    END CASE;

    IF v_jogada_usuario = v_jogada_pc_txt THEN
        v_vencedor := 'Empate';
    ELSIF (v_jogada_usuario = 'Pedra' AND v_jogada_pc_txt = 'Tesoura') OR
          (v_jogada_usuario = 'Tesoura' AND v_jogada_pc_txt = 'Papel') OR
          (v_jogada_usuario = 'Papel' AND v_jogada_pc_txt = 'Pedra') THEN
        v_vencedor := 'Usuário';
    ELSE
        v_vencedor := 'PC';
    END IF;

    DBMS_OUTPUT.PUT_LINE('==============================');
    DBMS_OUTPUT.PUT_LINE('RESULTADO DA RODADA');
    DBMS_OUTPUT.PUT_LINE('------------------------------');
    DBMS_OUTPUT.PUT_LINE('Jogador:    ' || RPAD(v_jogada_usuario, 10));
    DBMS_OUTPUT.PUT_LINE('Computador: ' || RPAD(v_jogada_pc_txt, 10));
    DBMS_OUTPUT.PUT_LINE('Vencedor:   ' || RPAD(v_vencedor, 10));
    DBMS_OUTPUT.PUT_LINE('------------------------------');
    DBMS_OUTPUT.PUT_LINE('Jogada registrada com sucesso!');
    DBMS_OUTPUT.PUT_LINE('==============================');

    INSERT INTO tb_jokenpo_resultado (jogada_usuario, jogada_pc, vencedor)
    VALUES (v_jogada_usuario, v_jogada_pc_txt, v_vencedor);

    DBMS_OUTPUT.PUT_LINE('Resultado registrado com sucesso!');
END;
/

-- ============================
-- 3. CRIAÇÃO DAS VIEWS
-- ============================
CREATE OR REPLACE VIEW vwHistoricoJokenpo AS
SELECT 
    id_jogada AS "ID da Jogada",
    jogada_usuario AS "Jogada do Usuário",
    jogada_pc AS "Jogada do PC",
    vencedor AS "Vencedor",
    TO_CHAR(data_jogada, 'DD/MM/YYYY HH24:MI:SS') AS "Data da Jogada"
FROM tb_jokenpo_resultado;

CREATE OR REPLACE VIEW vwEstatisticasJokenpo AS
SELECT 
    COUNT(*) AS "Total de Jogadas",
    COUNT(CASE WHEN vencedor = 'Usuário' THEN 1 END) AS "Vitórias do Usuário",
    COUNT(CASE WHEN vencedor = 'PC' THEN 1 END) AS "Vitórias do PC",
    COUNT(CASE WHEN vencedor = 'Empate' THEN 1 END) AS "Empates"
FROM tb_jokenpo_resultado;

-- ============================
-- 4. CONSULTA ÀS VIEWS
-- ============================
SELECT * FROM vwHistoricoJokenpo;
SELECT * FROM vwEstatisticasJokenpo;

-- ============================
-- 5. LIMPEZA DO AMBIENTE
-- ============================
DELETE FROM tb_jokenpo_resultado;
COMMIT;

DROP VIEW vwHistoricoJokenpo;
DROP VIEW vwEstatisticasJokenpo;

DROP TABLE tb_jokenpo_resultado;
```

---

## ✅ Checklist de Validação

- [ ] Tabela `tbJokenpo` criada com sucesso
- [ ] Procedure `jogarJokenpo` compilada sem erros
- [ ] Views `vwEstatisticasJokenpo` e `vwHistoricoJokenpo` criadas
- [ ] Jogadas executadas com `SET SERVEROUTPUT ON`
- [ ] Saída mostra resultado de cada partida
- [ ] Dados inseridos na tabela confirmados
- [ ] View de estatísticas mostra totais corretos
- [ ] View de histórico lista todas as jogadas
- [ ] Prints capturados para entrega
- [ ] Código comentado e documentado

---

## 🎓 Aprendizados do Exercício

Este exercício demonstra:

1. **Aleatoriedade em PL/SQL** - Uso do package `DBMS_RANDOM`
2. **Lógica condicional complexa** - Múltiplas condições com OR
3. **Persistência de dados** - INSERT após cada operação
4. **Views para relatórios** - Agregação de dados com CASE WHEN
5. **Procedures parametrizadas** - Receber entrada do usuário
6. **Tratamento de transações** - COMMIT explícito

---

## 📊 Exemplo de Resultados

### Após 10 Jogadas

**vwEstatisticasJokenpo:**
```
Total de Jogadas | Vitórias do Usuário | Vitórias do PC | Empates
-----------------|---------------------|----------------|--------
      10         |          3          |       5        |    2
```

**vwHistoricoJokenpo (últimas 5):**
```
ID | Jogada Usuário | Jogada PC | Resultado            | Data/Hora
---|----------------|-----------|----------------------|-------------------
10 | Papel          | Tesoura   | Vitória do PC        | 20/10/2025 15:45:32
9  | Pedra          | Pedra     | Empate               | 20/10/2025 15:45:31
8  | Tesoura        | Papel     | Vitória do Usuário   | 20/10/2025 15:45:30
7  | Papel          | Pedra     | Vitória do Usuário   | 20/10/2025 15:45:29
6  | Pedra          | Papel     | Vitória do PC        | 20/10/2025 15:45:28
```

---

## 🔗 Referências

- [Oracle DBMS_RANDOM Documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_RANDOM.html)
- [Oracle PL/SQL IF Statement](https://docs.oracle.com/en/database/oracle/oracle-database/19/lnpls/plsql-control-statements.html)
- [Oracle DBMS_OUTPUT](https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_OUTPUT.html)

---

**📅 Última atualização:** 20/10/2025  
**✍️ Autor:** Equipe LBDA  
**📧 Dúvidas:** Consultar professor ou monitor
